{"title":"Vue Axios 本地跨域代理配置（多域名）","uid":"14e29f5d4726b0098dc9a270e6fbed07","slug":"20220506-vue.config.js-http","date":"2022-05-06T01:23:00.000Z","updated":"2024-02-05T06:46:37.340Z","comments":true,"path":"api/articles/20220506-vue.config.js-http.json","keywords":null,"cover":null,"content":"<h1 id=\"vue-cli-3-的-vue-config-js-多域名跨域本地代理配置（与nginx-conf配置）\"><a href=\"#vue-cli-3-的-vue-config-js-多域名跨域本地代理配置（与nginx-conf配置）\" class=\"headerlink\" title=\"vue-cli 3 的 vue.config.js 多域名跨域本地代理配置（与nginx.conf配置）\"></a>vue-cli 3 的 vue.config.js 多域名跨域本地代理配置（与nginx.conf配置）</h1><h3 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h3><p>在做项目时碰到了需要请求好几个域名下的接口的情况，而接口是确定没问题的，所以没有后台的同事介入，只能自己本地代理解决跨域的问题。</p>\n<h3 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h3><p>在 <em>devServer.proxy</em>中配置多个域名的代理，然后在 <em>pathRewrite</em>中replace成’’，这样在请求后台接口时如果匹配到相应的代理名，如：<em><a href=\"http://127.0.0.1:8088/passportapi/XXX/XXX\">http://127.0.0.1:8088/passportapi/XXX/XXX</a></em>， 实际上是<em><a href=\"http://127.0.0.1:8088/XXX/XXX\">http://127.0.0.1:8088/XXX/XXX</a></em>，而反向代理又能够实现本地代理而不出现跨域的情况，目的就达到了。</p>\n<h3 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h3><ol>\n<li>vue.config.js</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">runtimeCompiler</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">productionSourceMap</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">lintOnSave</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">filenameHashing</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">outputDir</span>: <span class=\"string\">&#x27;dist&#x27;</span>,  <span class=\"comment\">// build打包后文件输出地址</span></span><br><span class=\"line\">    <span class=\"attr\">assetsDir</span>: <span class=\"string\">&#x27;static&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">configureWebpack</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">resolve</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">extensions</span>: [<span class=\"string\">&#x27;.js&#x27;</span>, <span class=\"string\">&#x27;.vue&#x27;</span>, <span class=\"string\">&#x27;.json&#x27;</span>],</span><br><span class=\"line\">            <span class=\"attr\">alias</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">vue$</span>: <span class=\"string\">&#x27;vue/dist/vue.esm.js&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;@&#x27;</span>: <span class=\"title function_\">resolve</span>(<span class=\"string\">&#x27;src&#x27;</span>),</span><br><span class=\"line\">                <span class=\"string\">&#x27;@utils&#x27;</span>: <span class=\"title function_\">resolve</span>(<span class=\"string\">&#x27;src/utils&#x27;</span>),</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">devServer</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">port</span>: <span class=\"number\">8088</span>,</span><br><span class=\"line\">        <span class=\"attr\">host</span>: <span class=\"string\">&#x27;127.0.0.1&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">disableHostCheck</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">open</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">proxy</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&#x27;/api1&#x27;</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">target</span>: <span class=\"string\">&#x27;https://aaaa.com&#x27;</span>, <span class=\"comment\">// //设置你调用的接口域名和端口号 别忘了加http</span></span><br><span class=\"line\">                <span class=\"attr\">ws</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">                <span class=\"attr\">changeOrigin</span>: <span class=\"literal\">true</span>, <span class=\"comment\">// 允许跨域</span></span><br><span class=\"line\">                <span class=\"attr\">sesure</span>: <span class=\"literal\">false</span>, <span class=\"comment\">// 如果是https接口，需要配置这个参数</span></span><br><span class=\"line\">                <span class=\"attr\">pathRewrite</span>: &#123; <span class=\"comment\">// 对路径匹配到的字符串重写</span></span><br><span class=\"line\">                    <span class=\"string\">&#x27;^/api1&#x27;</span>: <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            <span class=\"string\">&#x27;/api2&#x27;</span> : &#123;</span><br><span class=\"line\">                <span class=\"attr\">target</span>: <span class=\"string\">&#x27;https://bbbb.com&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">ws</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">                <span class=\"attr\">changeOrigin</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">                <span class=\"attr\">sesure</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">                <span class=\"attr\">pathRewrite</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">&#x27;^/api2&#x27;</span>: <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            <span class=\"string\">&#x27;/api3&#x27;</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">target</span>: <span class=\"string\">&#x27;https://cccc.com&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">ws</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">                <span class=\"attr\">changeOrigin</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">                <span class=\"attr\">sesure</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">                <span class=\"attr\">pathRewrite</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">&#x27;^/pai3&#x27;</span>: <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>2.request.js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> axios <span class=\"keyword\">from</span> <span class=\"string\">&#x27;axios&#x27;</span>;</span><br><span class=\"line\">axios.<span class=\"property\">defaults</span>.<span class=\"property\">withCredentials</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> service = axios.<span class=\"title function_\">create</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">baseURL</span>: <span class=\"string\">&#x27;/&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">timeout</span>: <span class=\"number\">2000</span>,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">service.<span class=\"property\">interceptors</span>.<span class=\"property\">request</span>.<span class=\"title function_\">use</span>(</span><br><span class=\"line\">    <span class=\"function\">(<span class=\"params\">config</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> config;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"function\">(<span class=\"params\">error</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(error);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title class_\">Promise</span>.<span class=\"title function_\">reject</span>(error);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">service.<span class=\"property\">interceptors</span>.<span class=\"property\">response</span>.<span class=\"title function_\">use</span>(</span><br><span class=\"line\">    <span class=\"function\">(<span class=\"params\">response</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> res = response.<span class=\"property\">data</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"function\">(<span class=\"params\">error</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`err<span class=\"subst\">$&#123;error&#125;</span>`</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title class_\">Promise</span>.<span class=\"title function_\">reject</span>(error);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> service;</span><br></pre></td></tr></table></figure>\n\n<p>3.api.js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> request <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@/utils/request&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">testpass</span>(<span class=\"params\">data</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title function_\">request</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;/api1/XXX/XXX&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">method</span>: <span class=\"string\">&#x27;post&#x27;</span>,</span><br><span class=\"line\">        data,</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">testsupport</span>(<span class=\"params\">data</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title function_\">request</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;/api2/XXX/XXX&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">method</span>: <span class=\"string\">&#x27;post&#x27;</span>,</span><br><span class=\"line\">        data,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">testlight</span>(<span class=\"params\">api</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title function_\">request</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">url</span>: <span class=\"string\">`/api3/XXX/XXX`</span>,</span><br><span class=\"line\">        <span class=\"attr\">method</span>: <span class=\"string\">&#x27;get&#x27;</span>,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>4.nginx.conf配置</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen       <span class=\"number\">80</span>;</span><br><span class=\"line\">    server_name  www.xxx.com;</span><br><span class=\"line\">    index index.html index.htm;</span><br><span class=\"line\">    <span class=\"comment\">#第一个vue项目</span></span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">            root   /usr/local/server/war/portal;</span><br><span class=\"line\">            index  index.html index.htm;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">#第二个vue项目</span></span><br><span class=\"line\">    location /bi &#123;</span><br><span class=\"line\">            alias   /usr/local/server/war/bi/;<span class=\"comment\">#注意这里</span></span><br><span class=\"line\">            index  index.html index.htm;</span><br><span class=\"line\">            try_files <span class=\"variable\">$uri</span> <span class=\"variable\">$uri</span>/ /bi/index.html; <span class=\"comment\">#解决页面刷新404问题</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">#后端项目 请求转发至8090端口</span></span><br><span class=\"line\">    location /prod-api &#123;</span><br><span class=\"line\">        proxy_set_header Host <span class=\"variable\">$host</span>;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-For <span class=\"variable\">$proxy_add_x_forwarded_for</span>;</span><br><span class=\"line\">        proxy_pass http:<span class=\"comment\">//您的ip地址:8090/prod-api;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    error_page   <span class=\"number\">500</span> <span class=\"number\">502</span> <span class=\"number\">503</span> <span class=\"number\">504</span>  /<span class=\"number\">50</span>x.html;</span><br><span class=\"line\">    location = /<span class=\"number\">50</span>x.html &#123;</span><br><span class=\"line\">        root   html;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>上面的情况比较复杂，由于接口的风格统一，如：<em><a href=\"https://aaaa.com/api/XXX%EF%BC%8Chttps://bbbb.com/api/XXX%EF%BC%8Chttps://cccc.com/api/XXX\">https://aaaa.com/api/XXX，https://bbbb.com/api/XXX，https://cccc.com/api/XXX</a></em>，也就是说域名后面的名字是一样的，所以需要多代理一层，也就导致axios请求的时候要 <em>&#x2F;passportapi&#x2F;api&#x2F;XXX</em> 这么复杂，如果都不一样，直接使用域名后面第一个单词来做代理名区分，这样axios也就只要 <em>&#x2F;XXX</em> 就行，<em>pathRewrite</em>也不用了。</p>\n","feature":true,"text":"vue-cli 3 的 vue.config.js 多域名跨域本地代理配置（与nginx.conf配置）背景在做项目时碰到了需要请求好几个域名下的接口的情况，而...","permalink":"/post/20220506-vue.config.js-http","photos":[],"count_time":{"symbolsCount":"4.3k","symbolsTime":"4 mins."},"categories":[{"name":"Vue","slug":"Vue","count":2,"path":"api/categories/Vue.json"}],"tags":[{"name":"配置","slug":"配置","count":1,"path":"api/tags/配置.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#vue-cli-3-%E7%9A%84-vue-config-js-%E5%A4%9A%E5%9F%9F%E5%90%8D%E8%B7%A8%E5%9F%9F%E6%9C%AC%E5%9C%B0%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE%EF%BC%88%E4%B8%8Enginx-conf%E9%85%8D%E7%BD%AE%EF%BC%89\"><span class=\"toc-text\">vue-cli 3 的 vue.config.js 多域名跨域本地代理配置（与nginx.conf配置）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%83%8C%E6%99%AF\"><span class=\"toc-text\">背景</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%80%9D%E8%B7%AF\"><span class=\"toc-text\">思路</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">代码</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">总结</span></a></li></ol></li></ol></li></ol>","author":{"name":"络擎","slug":"blog-author","avatar":"http://s-gz-2804-blog-image.oss.dogecdn.com/20230204150000.jpg","link":"/","description":"Think like an artist, develop like an artisan.","socials":{"github":"https://github.com/hehuixiong","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com","csdn":"https://blog.csdn.net","juejin":"https://juejin.cn","customs":{}}},"mapped":true,"hidden":false,"prev_post":{},"next_post":{"title":"Web前端性能优化","uid":"5add787e344d5502fefa25471add4e2d","slug":"20220226-front-end-performance-optimization","date":"2022-02-26T06:00:00.000Z","updated":"2024-02-05T06:46:37.339Z","comments":true,"path":"api/articles/20220226-front-end-performance-optimization.json","keywords":null,"cover":"https://s-gz-2804-blog-image.oss.dogecdn.com/20220223164807.png","text":"1、前置知识面试题：输入url到页面最终呈现都发生了什么？ url解析：判断输入是关键字搜索还是url访问，对url进行解析 dns域名解析获取ip地址 缓存查...","permalink":"/post/20220226-front-end-performance-optimization","photos":[],"count_time":{"symbolsCount":"12k","symbolsTime":"11 mins."},"categories":[{"name":"前端优化","slug":"前端优化","count":1,"path":"api/categories/前端优化.json"}],"tags":[{"name":"优化","slug":"优化","count":1,"path":"api/tags/优化.json"}],"author":{"name":"络擎","slug":"blog-author","avatar":"http://s-gz-2804-blog-image.oss.dogecdn.com/20230204150000.jpg","link":"/","description":"Think like an artist, develop like an artisan.","socials":{"github":"https://github.com/hehuixiong","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com","csdn":"https://blog.csdn.net","juejin":"https://juejin.cn","customs":{}}},"feature":true}}